<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elektronik Sınav - Giriş</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d3d6e; --primary-light: #1a5a96;
            --accent-color: #5bc0de; --info-dark: #31b0d5;
            --text-light: #e0e0e0; --text-dark: #ffffff; --placeholder-text: #cccccc99;
            --danger-color: #ff5252;
            --glass-bg: rgba(10, 25, 47, 0.8);
            --glass-border: rgba(255, 255, 255, 0.15);
            --input-bg: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Poppins', sans-serif; }
        .main-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(-45deg, #0d3d6e, #1a5a96, #002347, #154c79);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
        }
        .login-box {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            color: var(--text-dark);
            animation: fadeIn 0.6s ease-out;
        }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h1 { font-size: 2em; font-weight: 700; margin: 0 0 5px 0; }
        .login-header p { font-size: 1em; font-weight: 300; color: var(--text-light); margin: 0; }
        .form-group { margin-bottom: 20px; }
        .input-wrapper { position: relative; }
        .input-wrapper svg { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: var(--placeholder-text); }
        .form-group input, .kategori-sec-btn {
            width: 100%; padding: 14px 14px 14px 50px; background: var(--input-bg);
            border: 1px solid transparent; border-radius: 10px; font-size: 1em;
            color: var(--text-dark); box-sizing: border-box; transition: all 0.3s ease;
        }
        .form-group input:focus, .kategori-sec-btn:focus {
            background: rgba(255, 255, 255, 0.2); border-color: var(--glass-border);
            box-shadow: 0 0 0 3px rgba(91, 192, 222, 0.3); outline: none;
        }
        .form-group input::placeholder { color: var(--placeholder-text); }
        .kategori-sec-btn {
            text-align: left; cursor: pointer; display: flex;
            justify-content: space-between; align-items: center;
        }
        .kategori-sec-btn.secildi { font-weight: 600; }
        .kategori-sec-btn::after { content: '▼'; font-size: 0.8em; color: var(--placeholder-text); }
        .btn-submit { width: 100%; background: var(--accent-color); color: white; padding: 16px; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-submit:hover { background-color: var(--info-dark); transform: translateY(-2px); box-shadow: 0 4px 20px rgba(91, 192, 222, 0.3); }
        .btn-submit:disabled { background-color: #5a6268; cursor: not-allowed; transform: none; box-shadow: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; backdrop-filter: blur(5px); }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background: var(--glass-bg); border: 1px solid var(--glass-border); padding: 25px 30px; border-radius: 16px; width: 90%; max-width: 400px; transform: scale(0.9); transition: all 0.3s ease; box-shadow: var(--shadow); color: var(--text-dark); }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--glass-border);}
        .modal-header h2 { margin: 0; font-size: 1.3em; }
        .modal-close { background: none; border: none; font-size: 1.8em; color: var(--text-light); cursor: pointer; line-height: 1; }
        .modal-options { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; padding-right: 10px;}
        .modal-options button { width: 100%; padding: 15px; border-radius: 8px; font-size: 1em; font-weight: 500; cursor: pointer; border: none; transition: all 0.2s ease; background: var(--input-bg); color: var(--text-dark); flex-shrink: 0; }
        .modal-options button:hover { background: var(--accent-color); color: white; }
        .error-message { color: var(--danger-color); font-size: 0.9em; margin-top: 5px; display: none; text-align: center; background: rgba(255, 82, 82, 0.1); border: 1px solid rgba(255, 82, 82, 0.5); border-radius: 8px; padding: 10px; }
        .toggle-form, .past-exams-link { text-align: center; margin-top: 25px; font-weight: 400; color: var(--text-light); }
        .toggle-form a, .past-exams-link a { color: var(--accent-color); text-decoration: none; font-weight: 600; cursor: pointer; transition: color 0.2s; }
        .toggle-form a:hover, .past-exams-link a:hover { color: #fff; text-decoration: underline; }
        .past-exams-link { padding-top: 20px; border-top: 1px solid var(--glass-border); }
        @media (max-width: 480px) { .login-box { padding: 25px; } .login-header h1 { font-size: 1.8em; } }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="login-box">
            <div class="login-header">
                <h1 id="form-title">Öğrenci Girişi</h1>
                <p id="form-subtitle">Sınav dünyasına adım atın</p>
            </div>
            <form id="auth-form" onsubmit="return false;" novalidate>
                <div id="register-fields" style="display: none;">
                    <div class="form-group"><div class="input-wrapper"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"/></svg><input type="text" id="isim" placeholder="İsim" required></div></div>
                    <div class="form-group"><div class="input-wrapper"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"/></svg><input type="text" id="soyisim" placeholder="Soyisim" required></div></div>
                </div>
                <div class="form-group"><div class="input-wrapper"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg><input type="email" id="email" placeholder="E-posta Adresi" required></div></div>
                <div class="form-group"><div class="input-wrapper"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg><input type="password" id="password" placeholder="Şifre" required></div></div>
                <div id="confirm-password-field" class="form-group" style="display: none;"><div class="input-wrapper"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg><input type="password" id="confirm-password" placeholder="Şifreyi Onayla" required></div></div>
                <div id="kategori-group" class="form-group">
                    <div class="input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-8h14V7H7v2z"/></svg>
                         <button type="button" id="kategori-sec-btn" class="kategori-sec-btn" data-target-page="">Sınav Kategorisi Seçiniz</button>
                         <input type="hidden" id="kategori-secim-deger" required>
                    </div>
                    <span id="kategori-hata-mesaji" class="error-message">Lütfen bir kategori seçiniz.</span>
                </div>
                <div id="auth-error-message" class="error-message" style="margin-bottom: 15px;"></div>
                <button type="submit" id="submit-btn" class="btn-submit">Sınava Başla</button>
            </form>
            <div class="toggle-form"><span id="toggle-text">Hesabınız yok mu?</span> <a id="toggle-link">Kayıt Ol</a></div>
            <div id="past-exams-container" class="past-exams-link"><a href="gecmis-sinavlar.html">Geçmiş Sınavlarım</a></div>
        </div>
    </div>

    <div id="kategori-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Kategori Seçin</h2>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <div class="modal-options">
                <!-- YENİ EKLENEN BUTON -->
                <button type="button" data-value="cikmis_sorular" data-target-page="cikmis.html">Çıkmış Soru Çözüm</button>
                <hr style="border: none; border-top: 1px solid var(--glass-border); margin: 5px 0;">
                
                <!-- MEVCUT DİĞER BUTONLAR -->
                <button type="button" data-value="grammar" data-target-page="sinav.html">Grammar</button>
                <button type="button" data-value="vocabulary" data-target-page="sinav.html">Vocabulary</button>
                <button type="button" data-value="preposition" data-target-page="sinav.html">Preposition</button>
                <button type="button" data-value="sentence_completion" data-target-page="sinav.html">Sentence Completion</button>
                <button type="button" data-value="paragraph_completion" data-target-page="sinav.html">Paragraph Completion</button>
                <button type="button" data-value="situation" data-target-page="sinav.html">Situation</button>
                <button type="button" data-value="dialogue" data-target-page="sinav.html">Dialogue</button>
                <button type="button" data-value="translations" data-target-page="sinav.html">Translations</button>
                <button type="button" data-value="mismatching" data-target-page="sinav.html">Mismatching</button>
                <button type="button" data-value="paraphrasing" data-target-page="sinav.html">Paraphrasing</button>
                <hr style="border: none; border-top: 1px solid var(--glass-border); margin: 5px 0;">
                <button type="button" data-value="tf_reading" data-target-page="sinav_reading.html">T/F Reading Comprehension Test</button>
                <button type="button" data-value="advanced_reading" data-target-page="sinav_reading.html">Reading Comprehension Advanced Test</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyAvaEaHtTwcuCDBIggJGd4w_nzJQM5UlmY", authDomain: "teacher-adminpanel.firebaseapp.com", projectId: "teacher-adminpanel", storageBucket: "teacher-adminpanel.appspot.com", messagingSenderId: "901735644134", appId: "1:901735644134:web:a6aa575a0754de1333f427" };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const ui = {
            formTitle: document.getElementById('form-title'),
            formSubtitle: document.getElementById('form-subtitle'),
            submitBtn: document.getElementById('submit-btn'),
            authForm: document.getElementById('auth-form'),
            authErrorMessage: document.getElementById('auth-error-message'),
            toggleLink: document.getElementById('toggle-link'),
            toggleText: document.getElementById('toggle-text'),
            registerFields: document.getElementById('register-fields'),
            confirmPasswordField: document.getElementById('confirm-password-field'),
            kategoriGroup: document.getElementById('kategori-group'),
            pastExamsContainer: document.getElementById('past-exams-container'),
            kategoriModal: document.getElementById('kategori-modal'),
            kategoriSecBtn: document.getElementById('kategori-sec-btn'),
            kategoriDegerInput: document.getElementById('kategori-secim-deger'),
            kategoriHataMesaji: document.getElementById('kategori-hata-mesaji'),
            modalOptionsContainer: document.querySelector('#kategori-modal .modal-options'),
            closeModalBtn: document.querySelector('#kategori-modal .modal-close')
        };
        
        let isLoginMode = true;

        const setRegisterMode = () => {
            isLoginMode = false;
            ui.formTitle.textContent = 'Öğrenci Kayıt';
            ui.formSubtitle.textContent = 'Yeni bir hesap oluşturun';
            ui.registerFields.style.display = 'block';
            ui.confirmPasswordField.style.display = 'block';
            ui.kategoriGroup.style.display = 'none';
            ui.pastExamsContainer.style.display = 'none';
            ui.submitBtn.textContent = 'Hesabı Oluştur';
            ui.toggleText.textContent = 'Zaten bir hesabınız var mı?';
            ui.toggleLink.textContent = 'Giriş Yap';
            ui.authErrorMessage.style.display = 'none';
            document.getElementById('isim').required = true;
            document.getElementById('soyisim').required = true;
            document.getElementById('confirm-password').required = true;
            ui.kategoriDegerInput.required = false;
        };
        
        const setLoginMode = () => {
            isLoginMode = true;
            ui.formTitle.textContent = 'Öğrenci Girişi';
            ui.formSubtitle.textContent = 'Sınav dünyasına adım atın';
            ui.registerFields.style.display = 'none';
            ui.confirmPasswordField.style.display = 'none';
            ui.kategoriGroup.style.display = 'block';
            ui.pastExamsContainer.style.display = 'block';
            ui.submitBtn.textContent = 'Sınava Başla';
            ui.toggleText.textContent = 'Hesabınız yok mu?';
            ui.toggleLink.textContent = 'Kayıt Ol';
            ui.authErrorMessage.style.display = 'none';
            document.getElementById('isim').required = false;
            document.getElementById('soyisim').required = false;
            document.getElementById('confirm-password').required = false;
            ui.kategoriDegerInput.required = true;
        };
        
        const openModal = () => ui.kategoriModal.classList.add('show');
        const closeModal = () => ui.kategoriModal.classList.remove('show');
        ui.kategoriSecBtn.addEventListener('click', openModal);
        ui.closeModalBtn.addEventListener('click', closeModal);
        ui.kategoriModal.addEventListener('click', (event) => { if (event.target === ui.kategoriModal) closeModal(); });

        ui.modalOptionsContainer.addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                ui.kategoriDegerInput.value = event.target.dataset.value;
                ui.kategoriSecBtn.textContent = event.target.textContent;
                ui.kategoriSecBtn.dataset.targetPage = event.target.dataset.targetPage;
                ui.kategoriSecBtn.classList.add('secildi');
                ui.kategoriHataMesaji.style.display = 'none';
                closeModal();
            }
        });
        
        const showError = (message) => { ui.authErrorMessage.textContent = message; ui.authErrorMessage.style.display = 'block'; };
        const handleAuthError = (error) => {
            switch (error.code) {
                case 'auth/user-not-found':
                case 'auth/invalid-credential':
                    showError('E-posta veya şifre hatalı.'); break;
                case 'auth/email-already-in-use':
                    showError('Bu e-posta adresi zaten kullanılıyor.'); break;
                case 'auth/weak-password':
                    showError('Şifre en az 6 karakter olmalıdır.'); break;
                case 'auth/invalid-email':
                    showError('Lütfen geçerli bir e-posta adresi girin.'); break;
                default:
                    showError('Bir hata oluştu: ' + error.message); break;
            }
        };
        
        const handleLogin = async () => {
            if (!ui.kategoriDegerInput.value) {
                ui.kategoriHataMesaji.style.display = 'block'; return;
            }
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                sessionStorage.setItem('sinavTuru', ui.kategoriDegerInput.value);
                const targetPage = ui.kategoriSecBtn.dataset.targetPage || 'sinav.html';
                window.location.href = targetPage;
            } catch (error) {
                handleAuthError(error);
            }
        };

        const handleRegister = async () => {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            if (password !== confirmPassword) { showError("Şifreler uyuşmuyor!"); return; }

            const email = document.getElementById('email').value;
            const isim = document.getElementById('isim').value;
            const soyisim = document.getElementById('soyisim').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await setDoc(doc(db, "kullanicilar", user.uid), {
                    isim: isim, soyisim: soyisim, email: user.email, kayitTarihi: new Date()
                });
                alert('Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                setLoginMode();
            } catch (error) {
                handleAuthError(error);
            }
        };

        const handleFormSubmit = async (event) => {
            event.preventDefault();
            ui.authErrorMessage.style.display = 'none';
            if (!ui.authForm.checkValidity()) { ui.authForm.reportValidity(); return; }
            
            ui.submitBtn.disabled = true;
            ui.submitBtn.textContent = 'İşleniyor...';

            try {
                if (isLoginMode) await handleLogin();
                else await handleRegister();
            } finally {
                ui.submitBtn.disabled = false;
                ui.submitBtn.textContent = isLoginMode ? 'Sınava Başla' : 'Hesabı Oluştur';
            }
        };

        ui.authForm.addEventListener('submit', handleFormSubmit);
        ui.toggleLink.addEventListener('click', () => { isLoginMode ? setRegisterMode() : setLoginMode(); });

        setLoginMode();
    </script>
</body>
</html>
